<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>midiPredict</title>

    <!-- see https://github.com/nfroidure/midifile -->
    <script src="https://unpkg.com/@tonejs/midi"></script>
    
    <!-- <link rel="stylesheet" href="Paint.css"> -->
    <!-- <script src="midiPredict.js" ></script> -->
</head>

<!-- get input file -->
<input type="file" id="input">
<p id='fInfo'>No file selected</p>
<img src="" height="200" alt="Image preview...">
<script>
    //  console.log(Object.keys(selectedFile));

const validExtensions = ['mid', 'midi']
fInfo = document.getElementById('fInfo')
const img = document.querySelector('img');

function fileReceived() {
    const selectedFile = this.files[0];
    if (validExtensions.indexOf(selectedFile.name.split('.').pop()) >= 0) {
        
        const reader = new FileReader();
        reader.addEventListener("load", function () {

            const midi = new Midi(reader.result);
            
            console.log(Object.keys(midi.tracks));
            midi.tracks.forEach(track => {
            //tracks have notes and controlChanges
          
                //notes are an array
                const notes = track.notes;
                notes.forEach(note => {
                    fInfo.innerHTML = 'failed?';
                    fInfo.innerHTML = note.name;
                //note.midi, note.time, note.duration, note.name
                })
            })

        }, false);

        midiBin = reader.readAsArrayBuffer(selectedFile);
        
        // midiBin = reader.readAsBinaryString(selectedFile).result;
        // const midi = new Midi(midiBin);
        fInfo.innerHTML = 'failed?';



    } else {
        alert(`The file extension ${selectedFile.name.split('.').pop()} is invalid, must be in ${validExtensions}`);
        // for invalid file, try and load it as an image
        const reader = new FileReader();
        reader.addEventListener("load", function () {
            img.src = reader.result

        }, false);
        midiURL = reader.readAsDataURL(selectedFile);
    }
}

const inputElement = document.getElementById("input");
inputElement.addEventListener("change", fileReceived, false);
</script>


